<!-- Generated by PHPWord -->
<div style="page: page1;">Editor.php
<p>&nbsp;</p>
<p>&lt;?php</p>
<p>&nbsp;</p>
<p>session_start();</p>
<p>if (!isset($_SESSION['user_id'])) {</p>
<p>&nbsp; &nbsp; header('Location: index.php');</p>
<p>&nbsp; &nbsp; exit();</p>
<p>}</p>
<p>&nbsp;</p>
<p>$userName = isset($_SESSION['user_name']) ? $_SESSION['user_name'] : 'User';</p>
<p>$userId = $_SESSION['user_id'];</p>
<p>$baseStorageDir = './uploads/';</p>
<p>$uploadDir = $baseStorageDir . $userId . '/';</p>
<p>&nbsp;</p>
<p>$imageName = isset($_GET['image']) ? basename(urldecode($_GET['image'])) : null;</p>
<p>if (!$imageName) {</p>
<p>&nbsp; &nbsp; header('Location: drive.php');</p>
<p>&nbsp; &nbsp; exit();</p>
<p>}</p>
<p>&nbsp;</p>
<p>$imagePath = $uploadDir . 'images/' . $imageName;</p>
<p>if (!file_exists($imagePath)) {</p>
<p>&nbsp; &nbsp; header('Location: drive.php');</p>
<p>&nbsp; &nbsp; exit();</p>
<p>}</p>
<p>&nbsp;</p>
<p>?&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &lt;!DOCTYPE html&gt;</p>
<p>&nbsp; &lt;html lang="en"&gt;</p>
<p>&nbsp; &lt;head&gt;</p>
<p>&nbsp; &nbsp;</p>
<p>&nbsp; &nbsp; &lt;meta charset="UTF-8" /&gt;</p>
<p>&nbsp; &nbsp; &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</p>
<p>&nbsp; &nbsp; &lt;title&gt;Advanced Editor | CloudDrive&lt;/title&gt;</p>
<p>&nbsp; &nbsp; &lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet" /&gt;</p>
<p>&nbsp; &nbsp; &lt;link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" /&gt;</p>
<p>&nbsp; &nbsp; &lt;style&gt;</p>
<p>&nbsp; &nbsp; &nbsp; /* Reset and base */</p>
<p>&nbsp; &nbsp; &nbsp; *, *::before, *::after {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-sizing: border-box;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; body {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; margin: 0;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-family: 'Inter', sans-serif;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: #ffffff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; color: #333333;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; min-height: 100vh;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; display: flex;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; flex-direction: column;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; align-items: center;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; padding: 20px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; -webkit-font-smoothing: antialiased;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; -moz-osx-font-smoothing: grayscale;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; h1, h2 {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; margin-bottom: 0.25em;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-weight: 700;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; text-shadow: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; color: #222;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; h1 {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-size: 2.5rem;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; h2 {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-size: 1.25rem;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-weight: 600;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; color: #555;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; margin-bottom: 1rem;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; /* Container for editor */</p>
<p>&nbsp; &nbsp; &nbsp; .editor-container {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: #f9fbff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 16px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; padding: 24px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; max-width: 960px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; width: 100%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 8px 24px rgba(100, 120, 160, 0.15);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; display: flex;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; flex-direction: column;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; align-items: center;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; gap: 24px;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; /* Toolbar styling */</p>
<p>&nbsp; &nbsp; &nbsp; .toolbar {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; display: flex;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; flex-wrap: wrap;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; justify-content: center;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; gap: 16px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: #e6f0ff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; padding: 16px 20px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 12px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 0 15px rgba(30, 100, 230, 0.2);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; user-select: none;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; .toolbar-group {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; display: flex;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; gap: 12px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; align-items: center;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; /* Button styles */</p>
<p>&nbsp; &nbsp; &nbsp; button, select, input[type="range"], input[type="color"] {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-family: inherit;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-weight: 600;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-size: 0.9rem;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 12px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; padding: 10px 18px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: #87ceeb; /* sky blue */</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; color: #003366;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; cursor: pointer;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 3px 8px rgba(135, 206, 235, 0.45);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; transition: background-color 0.3s ease, transform 0.2s ease;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; min-width: 75px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; text-align: center;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; user-select:none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; display: flex;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; align-items: center;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; justify-content: center;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; gap: 6px;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; button:hover, select:hover, input[type="color"]:hover {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #5dade2;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; transform: scale(1.05);</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; button:active, select:active {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; transform: scale(0.97);</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; button:focus, select:focus, input[type="color"]:focus, input[type="range"]:focus {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; outline: 2px solid #3399ff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; outline-offset: 2px;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; button:disabled {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #aaccea;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; cursor: not-allowed;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; transform: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; color: #666666;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; /* Color picker and range slider */</p>
<p>&nbsp; &nbsp; &nbsp; input[type="color"] {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; padding: 0;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; width: 40px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; height: 40px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 50%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border: 2px solid #87ceeb;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; cursor: pointer;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; input[type="range"] {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; -webkit-appearance: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; appearance: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; width: 110px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; height: 8px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 8px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: #b3d9ff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; cursor: pointer;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; margin-left: 8px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; margin-right: 8px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; vertical-align: middle;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; input[type="range"]::-webkit-slider-thumb {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; -webkit-appearance: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; appearance: none;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; width: 20px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; height: 20px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 50%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: #3399ff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; cursor: pointer;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 0 8px rgba(51, 153, 255, 0.8);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border: 1px solid #187bcd;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; transition: background-color 0.3s ease;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; margin-top: -6px;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; input[type="range"]:focus::-webkit-slider-thumb {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #66b3ff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 0 12px rgba(102, 179, 255, 1);</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; input[type="range"]::-moz-range-thumb {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; width: 20px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; height: 20px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 50%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: #3399ff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; cursor: pointer;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border: 1px solid #187bcd;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; transition: background-color 0.3s ease;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 0 8px rgba(51, 153, 255, 0.8);</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; input[type="range"]:focus::-moz-range-thumb {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #66b3ff;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 0 12px rgba(102, 179, 255, 1);</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; /* Canvas container */</p>
<p>&nbsp; &nbsp; &nbsp; #canvas-container {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 16px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background: white;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: 0 12px 30px rgba(51, 153, 255, 0.15);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; max-width: 100%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; overflow: auto;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; cursor: crosshair;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; user-select:none;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; #canvas {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; display: block;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; max-width: 100%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; border-radius: 16px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; background-color: #fefefe;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; box-shadow: inset 0 0 12px rgba(0,0,0,0.05);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; image-rendering: pixelated;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; /* Responsive */</p>
<p>&nbsp; &nbsp; &nbsp; @media (max-width: 720px) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; .toolbar {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gap: 10px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; padding: 12px 10px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; button, select {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; min-width: 60px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; padding: 8px 12px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; font-size: 0.85rem;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; input[type="range"] {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width: 90px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; /* Material icons adjustment */</p>
<p>&nbsp; &nbsp; &nbsp; .material-icons {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-size: 18px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; vertical-align: middle;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; pointer-events: none;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; /* Material icons adjustment */</p>
<p>&nbsp; &nbsp; &nbsp; .material-icons {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-size: 18px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; vertical-align: middle;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; pointer-events: none;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &lt;/style&gt;</p>
<p>&nbsp; &lt;/head&gt;</p>
<p>&nbsp; &lt;body&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &lt;h1&gt;Welcome, &lt;?php echo htmlspecialchars($userName); ?&gt;!&lt;/h1&gt;</p>
<p>&nbsp; &lt;h2&gt;Editing: &lt;?php echo htmlspecialchars($imageName); ?&gt;&lt;/h2&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &lt;div class="editor-container"&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &lt;div id="canvas-container" aria-live="polite" aria-label="Image editing canvas"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;canvas id="canvas" tabindex="0" role="img" aria-describedby="canvasDesc"&gt;&lt;/canvas&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;div id="canvasDesc" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;"&gt;Canvas showing the image currently being edited.&lt;/div&gt;</p>
<p>&nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class="toolbar" role="toolbar" aria-label="Image editing tools"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;div class="toolbar-group" aria-label="Drawing controls"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="color" id="drawColorPicker" title="Select drawing color" aria-label="Drawing color picker" value="#000000" /&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;label for="drawSizeSlider" style="color:#336699; font-weight:600; margin-left:4px;"&gt;Size&lt;/label&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="range" id="drawSizeSlider" min="1" max="50" value="5" aria-label="Drawing size slider" /&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="drawBtn" aria-pressed="false" title="Toggle draw mode" aria-label="Toggle draw mode"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;brush&lt;/span&gt; Draw</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;div class="toolbar-group" aria-label="Basic transformations"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="cropBtn" title="Crop image" aria-label="Crop image"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;crop&lt;/span&gt; Crop</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="rotateBtn" title="Rotate 90 degrees" aria-label="Rotate image"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;rotate_right&lt;/span&gt; Rotate</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="flipHBtn" title="Flip Horizontally" aria-label="Flip image horizontally"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;flip&lt;/span&gt; Flip H</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="flipVBtn" title="Flip Vertically" aria-label="Flip image vertically"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;flip_camera_android&lt;/span&gt; Flip V</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;div class="toolbar-group" aria-label="Filters"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;select id="filterSelect" aria-label="Select filter to apply"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="normal"&gt;Normal&lt;/option&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="grayscale"&gt;Grayscale&lt;/option&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="sepia"&gt;Sepia&lt;/option&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="invert"&gt;Invert&lt;/option&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="brightness"&gt;Brightness +20%&lt;/option&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value="contrast"&gt;Contrast +20%&lt;/option&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;div class="toolbar-group" aria-label="Undo and saving"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="undoBtn" title="Undo last action" aria-label="Undo last action"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;undo&lt;/span&gt; Undo</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="saveBtn" title="Save edited image" aria-label="Save edited image"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;save&lt;/span&gt; Save</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button id="backBtn" title="Return to drive" aria-label="Back to drive" onclick="window.location.href='drive.php'"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="material-icons" aria-hidden="true"&gt;arrow_back&lt;/span&gt; Back</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &lt;/div&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &lt;script&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; window.currentImage = '&lt;?php echo htmlspecialchars($imageName); ?&gt;';</p>
<p>&nbsp; window.currentUser &nbsp;= '&lt;?php echo htmlspecialchars($userName); ?&gt;';</p>
<p>&nbsp;</p>
<p>&nbsp; const canvas = document.getElementById('canvas');</p>
<p>&nbsp; const ctx = canvas.getContext('2d');</p>
<p>&nbsp; const saveBtn = document.getElementById('saveBtn');</p>
<p>&nbsp; const drawBtn = document.getElementById('drawBtn');</p>
<p>&nbsp; const cropBtn = document.getElementById('cropBtn');</p>
<p>&nbsp; const rotateBtn = document.getElementById('rotateBtn');</p>
<p>&nbsp; const flipHBtn = document.getElementById('flipHBtn');</p>
<p>&nbsp; const flipVBtn = document.getElementById('flipVBtn');</p>
<p>&nbsp; const filterSelect = document.getElementById('filterSelect');</p>
<p>&nbsp; const undoBtn = document.getElementById('undoBtn');</p>
<p>&nbsp; const drawColorPicker = document.getElementById('drawColorPicker');</p>
<p>&nbsp; const drawSizeSlider = document.getElementById('drawSizeSlider');</p>
<p>&nbsp; const backBtn = document.getElementById('backBtn');</p>
<p>&nbsp;</p>
<p>&nbsp; let drawing = false, isDrawingMode = false;</p>
<p>&nbsp; let lastX = 0, lastY = 0;</p>
<p>&nbsp;</p>
<p>&nbsp; // Store a copy of the original image for erasing only the drawing</p>
<p>&nbsp; let baseImageData = null;</p>
<p>&nbsp;</p>
<p>async function init() {</p>
<p>&nbsp; const imageName = window.currentImage;</p>
<p>&nbsp; const userId = '&lt;?php echo $userId; ?&gt;';</p>
<p>&nbsp; const imagePath = `uploads/${userId}/images/${encodeURIComponent(imageName)}`;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp; const img = new Image();</p>
<p>&nbsp; img.crossOrigin = "anonymous";</p>
<p>&nbsp; img.src = imagePath;</p>
<p>&nbsp; await img.decode();</p>
<p>&nbsp;</p>
<p>&nbsp; canvas.width = img.width;</p>
<p>&nbsp; canvas.height = img.height;</p>
<p>&nbsp; ctx.drawImage(img, 0, 0);</p>
<p>&nbsp; originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; saveState();</p>
<p>&nbsp; updateDrawButton();</p>
<p>}</p>
<p>&nbsp;</p>
<p>&nbsp; // Erase only the drawing (not the image)</p>
<p>&nbsp; function eraseAt(x, y, size) {</p>
<p>&nbsp; &nbsp; // Restore base image to a temp canvas</p>
<p>&nbsp; &nbsp; const tempCanvas = document.createElement('canvas');</p>
<p>&nbsp; &nbsp; tempCanvas.width = canvas.width;</p>
<p>&nbsp; &nbsp; tempCanvas.height = canvas.height;</p>
<p>&nbsp; &nbsp; const tempCtx = tempCanvas.getContext('2d');</p>
<p>&nbsp; &nbsp; tempCtx.putImageData(baseImageData, 0, 0);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; // Copy current canvas to temp, but mask erase area with base image</p>
<p>&nbsp; &nbsp; tempCtx.save();</p>
<p>&nbsp; &nbsp; tempCtx.beginPath();</p>
<p>&nbsp; &nbsp; tempCtx.arc(x, y, size / 2, 0, 2 * Math.PI);</p>
<p>&nbsp; &nbsp; tempCtx.clip();</p>
<p>&nbsp; &nbsp; tempCtx.drawImage(canvas, 0, 0);</p>
<p>&nbsp; &nbsp; tempCtx.restore();</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; // Draw temp canvas back to main canvas, only in erase area</p>
<p>&nbsp; &nbsp; ctx.save();</p>
<p>&nbsp; &nbsp; ctx.beginPath();</p>
<p>&nbsp; &nbsp; ctx.arc(x, y, size / 2, 0, 2 * Math.PI);</p>
<p>&nbsp; &nbsp; ctx.clip();</p>
<p>&nbsp; &nbsp; ctx.drawImage(tempCanvas, 0, 0);</p>
<p>&nbsp; &nbsp; ctx.restore();</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; // Override draw function to erase only drawing</p>
<p>&nbsp; function draw(e) {</p>
<p>&nbsp; &nbsp; if (!drawing) return;</p>
<p>&nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; const x = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; const y = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; ctx.save();</p>
<p>&nbsp; &nbsp; if (isErasingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; eraseAt(x, y, drawSizeSlider.value);</p>
<p>&nbsp; &nbsp; } else if (isDrawingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; ctx.fillStyle = drawColorPicker.value;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.beginPath();</p>
<p>&nbsp; &nbsp; &nbsp; ctx.arc(x, y, drawSizeSlider.value / 2, 0, 2 * Math.PI);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.fill();</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; ctx.restore();</p>
<p>&nbsp; &nbsp; lastX = x;</p>
<p>&nbsp; &nbsp; lastY = y;</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; // When saving, update baseImageData so erase works after save</p>
<p>&nbsp; saveBtn.addEventListener('click', async () =&gt; {</p>
<p>&nbsp; &nbsp; try {</p>
<p>&nbsp; &nbsp; &nbsp; const dataUrl = canvas.toDataURL('image/png');</p>
<p>&nbsp; &nbsp; &nbsp; const blob = await (await fetch(dataUrl)).blob();</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; const formData = new FormData();</p>
<p>&nbsp; &nbsp; &nbsp; formData.append('edited_image', blob, window.currentImage);</p>
<p>&nbsp; &nbsp; &nbsp; formData.append('original_name', window.currentImage);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; const saveResponse = await fetch('save_image.php', { method: 'POST', body: formData });</p>
<p>&nbsp; &nbsp; &nbsp; const result = await saveResponse.json();</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; if (result.success) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; alert('Image saved successfully!');</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; // Update baseImageData to current image after save</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; baseImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; window.location.href = 'drive.php';</p>
<p>&nbsp; &nbsp; &nbsp; } else {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; alert('Failed to save image.');</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; } catch (error) {</p>
<p>&nbsp; &nbsp; &nbsp; alert('An error occurred while saving the image.');</p>
<p>&nbsp; &nbsp; &nbsp; console.error(error);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; // No erase tool, nothing to do here.</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; // Erase tool state</p>
<p>&nbsp;</p>
<p>&nbsp; canvas.addEventListener('mousedown', (e) =&gt; {</p>
<p>&nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; if (cropMode) {</p>
<p>&nbsp; &nbsp; &nbsp; cropStartX = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; &nbsp; cropStartY = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; } else if (isDrawingMode || isErasingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; drawing = true;</p>
<p>&nbsp; &nbsp; &nbsp; const x = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; &nbsp; const y = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; &nbsp; lastX = x;</p>
<p>&nbsp; &nbsp; &nbsp; lastY = y;</p>
<p>&nbsp; &nbsp; &nbsp; draw(e);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; canvas.addEventListener('mousemove', (e) =&gt; {</p>
<p>&nbsp; &nbsp; if (!drawing) return;</p>
<p>&nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; const x = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; const y = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; ctx.save();</p>
<p>&nbsp; &nbsp; if (isErasingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; ctx.globalCompositeOperation = 'destination-out';</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineCap = 'round';</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineJoin = 'round';</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineWidth = drawSizeSlider.value;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.beginPath();</p>
<p>&nbsp; &nbsp; &nbsp; ctx.moveTo(lastX, lastY);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineTo(x, y);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.stroke();</p>
<p>&nbsp; &nbsp; &nbsp; ctx.globalCompositeOperation = 'source-over';</p>
<p>&nbsp; &nbsp; } else if (isDrawingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; ctx.strokeStyle = drawColorPicker.value;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineCap = 'round';</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineJoin = 'round';</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineWidth = drawSizeSlider.value;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.beginPath();</p>
<p>&nbsp; &nbsp; &nbsp; ctx.moveTo(lastX, lastY);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.lineTo(x, y);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.stroke();</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; ctx.restore();</p>
<p>&nbsp; &nbsp; lastX = x;</p>
<p>&nbsp; &nbsp; lastY = y;</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; canvas.addEventListener('mouseup', (e) =&gt; {</p>
<p>&nbsp; &nbsp; if (cropMode) {</p>
<p>&nbsp; &nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; &nbsp; const endX = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; &nbsp; const endY = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; &nbsp; const cropWidth = endX - cropStartX;</p>
<p>&nbsp; &nbsp; &nbsp; const cropHeight = endY - cropStartY;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; const safeCropWidth = Math.min(cropWidth, canvas.width - cropStartX);</p>
<p>&nbsp; &nbsp; &nbsp; const safeCropHeight = Math.min(cropHeight, canvas.height - cropStartY);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; if(safeCropWidth &gt; 0 &amp;&amp; safeCropHeight &gt; 0){</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; const imageData = ctx.getImageData(cropStartX, cropStartY, safeCropWidth, safeCropHeight);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; canvas.width = safeCropWidth;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; canvas.height = safeCropHeight;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; ctx.putImageData(imageData, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; cropMode = false;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; if (drawing &amp;&amp; (isDrawingMode || isErasingMode)) {</p>
<p>&nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; drawing = false;</p>
<p>&nbsp; });</p>
<p>&nbsp; let isErasingMode = false;</p>
<p>&nbsp; const eraseBtn = document.createElement('button');</p>
<p>&nbsp; eraseBtn.id = 'eraseBtn';</p>
<p>&nbsp; eraseBtn.title = 'Toggle erase mode';</p>
<p>&nbsp;</p>
<p>&nbsp; eraseBtn.setAttribute('aria-label', 'Toggle erase mode');</p>
<p>&nbsp; eraseBtn.innerHTML = '&lt;span class="material-icons" aria-hidden="true"&gt;auto_fix_off&lt;/span&gt; Erase';</p>
<p>&nbsp;</p>
<p>&nbsp; // Insert erase button after drawBtn in the toolbar</p>
<p>&nbsp; drawBtn.parentNode.insertBefore(eraseBtn, drawBtn.nextSibling);</p>
<p>&nbsp;</p>
<p>&nbsp; function updateEraseButton() {</p>
<p>&nbsp; &nbsp; eraseBtn.setAttribute('aria-pressed', isErasingMode ? 'true' : 'false');</p>
<p>&nbsp; &nbsp; eraseBtn.style.backgroundColor = isErasingMode ? '#5dade2' : '#87ceeb';</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; eraseBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; isErasingMode = !isErasingMode;</p>
<p>&nbsp; &nbsp; &nbsp; isDrawingMode = false;</p>
<p>&nbsp; &nbsp; &nbsp; cropMode = false;</p>
<p>&nbsp; &nbsp; &nbsp; updateEraseButton();</p>
<p>&nbsp; &nbsp; &nbsp; updateDrawButton();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; // Update drawBtn to disable erase mode when drawing mode is toggled</p>
<p>&nbsp; drawBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; isErasingMode = false;</p>
<p>&nbsp; &nbsp; &nbsp; updateEraseButton();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; // Update cropBtn to disable erase mode when crop mode is toggled</p>
<p>&nbsp; cropBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; isErasingMode = false;</p>
<p>&nbsp; &nbsp; &nbsp; updateEraseButton();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; // Modify draw function to support erase mode</p>
<p>&nbsp; function draw(e) {</p>
<p>&nbsp; &nbsp; &nbsp; if (!drawing) return;</p>
<p>&nbsp; &nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; &nbsp; const x = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; &nbsp; const y = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.save();</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; if (isErasingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eraseAt(x, y, drawSizeSlider.value);</p>
<p>&nbsp; &nbsp; &nbsp; } else if (isDrawingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fillStyle = drawColorPicker.value;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.beginPath();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.arc(x, y, drawSizeSlider.value / 2, 0, 2 * Math.PI);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.fill();</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.restore();</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; let cropMode = false, cropStartX, cropStartY;</p>
<p>&nbsp; let undoStack = [];</p>
<p>&nbsp; let originalImageData = null;</p>
<p>&nbsp;</p>
<p>&nbsp; async function init() {</p>
<p>&nbsp; &nbsp; &nbsp; const imageName = window.currentImage;</p>
<p>&nbsp; &nbsp; &nbsp; const userId = '&lt;?php echo $userId; ?&gt;';</p>
<p>&nbsp; &nbsp; &nbsp; const imagePath = `uploads/${userId}/images/${encodeURIComponent(imageName)}`;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; const img = new Image();</p>
<p>&nbsp; &nbsp; &nbsp; img.crossOrigin = "anonymous";</p>
<p>&nbsp; &nbsp; &nbsp; img.src = imagePath;</p>
<p>&nbsp; &nbsp; &nbsp; await img.decode();</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; canvas.width = img.width;</p>
<p>&nbsp; &nbsp; &nbsp; canvas.height = img.height;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.drawImage(img, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; &nbsp; &nbsp; updateDrawButton();</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; function updateDrawButton() {</p>
<p>&nbsp; &nbsp; drawBtn.setAttribute('aria-pressed', isDrawingMode ? 'true' : 'false');</p>
<p>&nbsp; &nbsp; drawBtn.style.backgroundColor = isDrawingMode ? '#5dade2' : '#87ceeb';</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; drawBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; isDrawingMode = !isDrawingMode;</p>
<p>&nbsp; &nbsp; &nbsp; cropMode = false;</p>
<p>&nbsp; &nbsp; &nbsp; updateDrawButton();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; canvas.addEventListener('mousedown', (e) =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; &nbsp; if (cropMode) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cropStartX = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cropStartY = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; &nbsp; } else if (isDrawingMode) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; drawing = true;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; draw(e);</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; canvas.addEventListener('mouseup', (e) =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; if (cropMode) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const endX = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const endY = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const cropWidth = endX - cropStartX;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const cropHeight = endY - cropStartY;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const safeCropWidth = Math.min(cropWidth, canvas.width - cropStartX);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const safeCropHeight = Math.min(cropHeight, canvas.height - cropStartY);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(safeCropWidth &gt; 0 &amp;&amp; safeCropHeight &gt; 0){</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const imageData = ctx.getImageData(cropStartX, cropStartY, safeCropWidth, safeCropHeight);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; canvas.width = safeCropWidth;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; canvas.height = safeCropHeight;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.putImageData(imageData, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cropMode = false;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; drawing = false;</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; canvas.addEventListener('mousemove', draw);</p>
<p>&nbsp;</p>
<p>&nbsp; function draw(e) {</p>
<p>&nbsp; &nbsp; &nbsp; if (!drawing) return;</p>
<p>&nbsp; &nbsp; &nbsp; const rect = canvas.getBoundingClientRect();</p>
<p>&nbsp; &nbsp; &nbsp; const x = e.clientX - rect.left;</p>
<p>&nbsp; &nbsp; &nbsp; const y = e.clientY - rect.top;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.fillStyle = drawColorPicker.value;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.beginPath();</p>
<p>&nbsp; &nbsp; &nbsp; ctx.arc(x, y, drawSizeSlider.value / 2, 0, 2 * Math.PI);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.fill();</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; cropBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; cropMode = true;</p>
<p>&nbsp; &nbsp; &nbsp; isDrawingMode = false;</p>
<p>&nbsp; &nbsp; &nbsp; updateDrawButton();</p>
<p>&nbsp; &nbsp; &nbsp; alert('Click and drag on canvas to select crop area.');</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; rotateBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; const tmpCanvas = document.createElement('canvas');</p>
<p>&nbsp; &nbsp; &nbsp; const tmpCtx = tmpCanvas.getContext('2d');</p>
<p>&nbsp; &nbsp; &nbsp; tmpCanvas.width = canvas.height;</p>
<p>&nbsp; &nbsp; &nbsp; tmpCanvas.height = canvas.width;</p>
<p>&nbsp; &nbsp; &nbsp; tmpCtx.translate(tmpCanvas.width / 2, tmpCanvas.height / 2);</p>
<p>&nbsp; &nbsp; &nbsp; tmpCtx.rotate(90 * Math.PI / 180);</p>
<p>&nbsp; &nbsp; &nbsp; tmpCtx.drawImage(canvas, -canvas.width / 2, -canvas.height / 2);</p>
<p>&nbsp; &nbsp; &nbsp; canvas.width = tmpCanvas.width;</p>
<p>&nbsp; &nbsp; &nbsp; canvas.height = tmpCanvas.height;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.drawImage(tmpCanvas, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; flipHBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; ctx.translate(canvas.width, 0);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.scale(-1, 1);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.drawImage(canvas, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.setTransform(1, 0, 0, 1, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; flipVBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; ctx.translate(0, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.scale(1, -1);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.drawImage(canvas, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; ctx.setTransform(1, 0, 0, 1, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; filterSelect.addEventListener('change', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; const filter = filterSelect.value;</p>
<p>&nbsp; &nbsp; &nbsp; if (filter === 'normal') {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.putImageData(originalImageData, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; const data = imageData.data;</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; if (filter === 'grayscale') {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; data.length; i += 4) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i] = data[i + 1] = data[i + 2] = avg;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; else if (filter === 'sepia') {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; data.length; i += 4) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const r = data[i], g = data[i + 1], b = data[i + 2];</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i] = r * 0.393 + g * 0.769 + b * 0.189;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 1] = r * 0.349 + g * 0.686 + b * 0.168;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 2] = r * 0.272 + g * 0.534 + b * 0.131;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; else if (filter === 'invert') {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; data.length; i += 4) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i] = 255 - data[i];</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 1] = 255 - data[i + 1];</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 2] = 255 - data[i + 2];</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; else if (filter === 'brightness') {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; data.length; i += 4) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i] = Math.min(255, data[i] * 1.2);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 1] = Math.min(255, data[i + 1] * 1.2);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 2] = Math.min(255, data[i + 2] * 1.2);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; else if (filter === 'contrast') {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const contrast = 1.2;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const intercept = 128 * (1 - contrast);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; data.length; i += 4) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i] = Math.min(255, data[i] * contrast + intercept);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 1] = Math.min(255, data[i + 1] * contrast + intercept);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[i + 2] = Math.min(255, data[i + 2] * contrast + intercept);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; ctx.putImageData(imageData, 0, 0);</p>
<p>&nbsp; &nbsp; &nbsp; saveState();</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; undoBtn.addEventListener('click', () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; if (undoStack.length &gt; 1) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; undoStack.pop();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const prevImage = undoStack[undoStack.length - 1];</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const img = new Image();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.onload = () =&gt; ctx.drawImage(img, 0, 0, canvas.width, canvas.height);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.src = prevImage;</p>
<p>&nbsp; &nbsp; &nbsp; } else {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('No more undo steps available.');</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; saveBtn.addEventListener('click', async () =&gt; {</p>
<p>&nbsp; &nbsp; &nbsp; try {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const dataUrl = canvas.toDataURL('image/png');</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const blob = await (await fetch(dataUrl)).blob();</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const formData = new FormData();</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; formData.append('edited_image', blob, window.currentImage);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; formData.append('original_name', window.currentImage);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const saveResponse = await fetch('save_image.php', { method: 'POST', body: formData });</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const result = await saveResponse.json();</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (result.success) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('Image saved successfully!');</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; window.location.href = 'drive.php';</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('Failed to save image.');</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; } catch (error) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('An error occurred while saving the image.');</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error(error);</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; });</p>
<p>&nbsp;</p>
<p>&nbsp; function saveState() {</p>
<p>&nbsp; &nbsp; &nbsp; undoStack.push(canvas.toDataURL());</p>
<p>&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; window.addEventListener('load', init);</p>
<p>&nbsp; &lt;/script&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &lt;/body&gt;</p>
<p>&nbsp; &lt;/html&gt;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
Saved_image.php
<p>&nbsp;</p>
<p>&lt;?php</p>
<p>session_start();</p>
<p>header('Content-Type: application/json');</p>
<p>&nbsp;</p>
<p>if (!isset($_SESSION['user_id'])) {</p>
<p>&nbsp; &nbsp; echo json_encode(['success' =&gt; false, 'message' =&gt; 'Not logged in']);</p>
<p>&nbsp; &nbsp; exit();</p>
<p>}</p>
<p>&nbsp;</p>
<p>$userId = $_SESSION['user_id'];</p>
<p>&nbsp;</p>
<p>if (!isset($_FILES['edited_image']) || $_FILES['edited_image']['error'] !== UPLOAD_ERR_OK || !isset($_POST['original_name'])) {</p>
<p>&nbsp; &nbsp; echo json_encode(['success' =&gt; false, 'message' =&gt; 'Missing image or file name']);</p>
<p>&nbsp; &nbsp; exit();</p>
<p>}</p>
<p>&nbsp;</p>
<p>$filename = basename($_POST['original_name']);</p>
<p>$fileType = strtolower(pathinfo($filename, PATHINFO_EXTENSION));</p>
<p>$saveFolder = './uploads/' . $userId . '/images/';</p>
<p>&nbsp;</p>
<p>if (!is_dir($saveFolder)) {</p>
<p>&nbsp; &nbsp; mkdir($saveFolder, 0755, true);</p>
<p>}</p>
<p>&nbsp;</p>
<p>$savePath = $saveFolder . $filename;</p>
<p>&nbsp;</p>
<p>if (move_uploaded_file($_FILES['edited_image']['tmp_name'], $savePath)) {</p>
<p>&nbsp; &nbsp; chmod($savePath, 0644);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; try {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $pdo = new PDO("mysql:host=localhost;dbname=user_auth", "root", "");</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; // Update or insert</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $stmt = $pdo-&gt;prepare("UPDATE uploaded_images SET file_path = ?, uploaded_at = NOW() WHERE file_name = ? AND user_id = ?");</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $stmt-&gt;execute([$savePath, $filename, $userId]);</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; if ($stmt-&gt;rowCount() === 0) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $stmt = $pdo-&gt;prepare("INSERT INTO uploaded_images (user_id, file_name, file_path, file_type, uploaded_at) VALUES (?, ?, ?, ?, NOW())");</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $stmt-&gt;execute([$userId, $filename, $savePath, $fileType]);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; } catch (Exception $e) {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; echo json_encode(['success' =&gt; false, 'message' =&gt; 'Database error: ' . $e-&gt;getMessage()]);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; exit();</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; echo json_encode(['success' =&gt; true]);</p>
<p>&nbsp; &nbsp; exit();</p>
<p>} else {</p>
<p>&nbsp; &nbsp; echo json_encode(['success' =&gt; false, 'message' =&gt; 'Failed to move uploaded image']);</p>
<p>&nbsp; &nbsp; exit();</p>
<p>}</p>
<p>?&gt;</p>
<p>&nbsp;</p>
<p>&lt;!DOCTYPE html&gt;</p>
<p>&lt;html lang="en"&gt;</p>
<p>&lt;head&gt;</p>
<p>&nbsp; &lt;meta charset="UTF-8"&gt;</p>
<p>&nbsp; &lt;title&gt;Saved Images&lt;/title&gt;</p>
<p>&nbsp; &lt;style&gt;</p>
<p>&nbsp; &nbsp; /* Base and body styles */</p>
<p>&nbsp; &nbsp; body {</p>
<p>&nbsp; &nbsp; &nbsp; font-family: 'Inter', Arial, sans-serif;</p>
<p>&nbsp; &nbsp; &nbsp; background-color: #ffffff; /* White background */</p>
<p>&nbsp; &nbsp; &nbsp; color: #003366; /* Dark blue text */</p>
<p>&nbsp; &nbsp; &nbsp; text-align: center;</p>
<p>&nbsp; &nbsp; &nbsp; margin: 40px 20px;</p>
<p>&nbsp; &nbsp; &nbsp; padding: 0;</p>
<p>&nbsp; &nbsp; &nbsp; line-height: 1.6;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; h1 {</p>
<p>&nbsp; &nbsp; &nbsp; font-weight: 700;</p>
<p>&nbsp; &nbsp; &nbsp; font-size: 2.2rem;</p>
<p>&nbsp; &nbsp; &nbsp; margin-bottom: 40px;</p>
<p>&nbsp; &nbsp; &nbsp; letter-spacing: 0.03em;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; /* Gallery grid styles */</p>
<p>&nbsp; &nbsp; .gallery {</p>
<p>&nbsp; &nbsp; &nbsp; display: grid;</p>
<p>&nbsp; &nbsp; &nbsp; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));</p>
<p>&nbsp; &nbsp; &nbsp; gap: 32px; /* generous gap */</p>
<p>&nbsp; &nbsp; &nbsp; max-width: 1200px;</p>
<p>&nbsp; &nbsp; &nbsp; margin: 0 auto 48px auto;</p>
<p>&nbsp; &nbsp; &nbsp; padding: 0 16px;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; /* Each image container */</p>
<p>&nbsp; &nbsp; .gallery &gt; div {</p>
<p>&nbsp; &nbsp; &nbsp; display: flex;</p>
<p>&nbsp; &nbsp; &nbsp; flex-direction: column;</p>
<p>&nbsp; &nbsp; &nbsp; align-items: center;</p>
<p>&nbsp; &nbsp; &nbsp; background: #f8fbff;</p>
<p>&nbsp; &nbsp; &nbsp; border-radius: 12px;</p>
<p>&nbsp; &nbsp; &nbsp; padding: 16px;</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 4px 16px rgba(3, 27, 68, 0.1);</p>
<p>&nbsp; &nbsp; &nbsp; transition: box-shadow 0.3s ease;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; .gallery &gt; div:hover {</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 8px 28px rgba(3, 27, 68, 0.2);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; /* Images styling */</p>
<p>&nbsp; &nbsp; img {</p>
<p>&nbsp; &nbsp; &nbsp; width: 100%;</p>
<p>&nbsp; &nbsp; &nbsp; height: auto;</p>
<p>&nbsp; &nbsp; &nbsp; border-radius: 10px;</p>
<p>&nbsp; &nbsp; &nbsp; border: 1px solid #cbd6f0;</p>
<p>&nbsp; &nbsp; &nbsp; object-fit: cover;</p>
<p>&nbsp; &nbsp; &nbsp; margin-bottom: 16px;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; /* Form and buttons styling */</p>
<p>&nbsp; &nbsp; form {</p>
<p>&nbsp; &nbsp; &nbsp; display: flex;</p>
<p>&nbsp; &nbsp; &nbsp; justify-content: center;</p>
<p>&nbsp; &nbsp; &nbsp; gap: 12px;</p>
<p>&nbsp; &nbsp; &nbsp; flex-wrap: wrap;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; button {</p>
<p>&nbsp; &nbsp; &nbsp; background-color: #87ceeb; /* sky blue */</p>
<p>&nbsp; &nbsp; &nbsp; color: #ffffff;</p>
<p>&nbsp; &nbsp; &nbsp; border: none;</p>
<p>&nbsp; &nbsp; &nbsp; padding: 10px 20px;</p>
<p>&nbsp; &nbsp; &nbsp; border-radius: 8px;</p>
<p>&nbsp; &nbsp; &nbsp; font-size: 1rem;</p>
<p>&nbsp; &nbsp; &nbsp; font-weight: 600;</p>
<p>&nbsp; &nbsp; &nbsp; cursor: pointer;</p>
<p>&nbsp; &nbsp; &nbsp; transition: background-color 0.3s ease, transform 0.2s ease;</p>
<p>&nbsp; &nbsp; &nbsp; min-width: 90px;</p>
<p>&nbsp; &nbsp; &nbsp; user-select: none;</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 2px 8px rgba(135, 206, 235, 0.5);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; button:hover,</p>
<p>&nbsp; &nbsp; button:focus {</p>
<p>&nbsp; &nbsp; &nbsp; background-color: #5aa7db;</p>
<p>&nbsp; &nbsp; &nbsp; outline: none;</p>
<p>&nbsp; &nbsp; &nbsp; transform: translateY(-2px);</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 4px 14px rgba(90, 167, 219, 0.7);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; button:active {</p>
<p>&nbsp; &nbsp; &nbsp; transform: translateY(0);</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 2px 8px rgba(135, 206, 235, 0.5);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; /* Back to drive button styles */</p>
<p>&nbsp; &nbsp; body &gt; button {</p>
<p>&nbsp; &nbsp; &nbsp; background-color: #87ceeb;</p>
<p>&nbsp; &nbsp; &nbsp; color: white;</p>
<p>&nbsp; &nbsp; &nbsp; border: none;</p>
<p>&nbsp; &nbsp; &nbsp; padding: 12px 32px;</p>
<p>&nbsp; &nbsp; &nbsp; border-radius: 10px;</p>
<p>&nbsp; &nbsp; &nbsp; font-size: 1.1rem;</p>
<p>&nbsp; &nbsp; &nbsp; font-weight: 700;</p>
<p>&nbsp; &nbsp; &nbsp; cursor: pointer;</p>
<p>&nbsp; &nbsp; &nbsp; transition: background-color 0.3s ease, transform 0.2s ease;</p>
<p>&nbsp; &nbsp; &nbsp; user-select: none;</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 4px 16px rgba(135, 206, 235, 0.6);</p>
<p>&nbsp; &nbsp; &nbsp; margin-top: 32px;</p>
<p>&nbsp; &nbsp; &nbsp; max-width: 240px;</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; body &gt; button:hover,</p>
<p>&nbsp; &nbsp; body &gt; button:focus {</p>
<p>&nbsp; &nbsp; &nbsp; background-color: #5aa7db;</p>
<p>&nbsp; &nbsp; &nbsp; outline: none;</p>
<p>&nbsp; &nbsp; &nbsp; transform: translateY(-2px);</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 8px 28px rgba(90, 167, 219, 0.8);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; body &gt; button:active {</p>
<p>&nbsp; &nbsp; &nbsp; transform: translateY(0);</p>
<p>&nbsp; &nbsp; &nbsp; box-shadow: 0 4px 16px rgba(135, 206, 235, 0.6);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp; /* Responsive adjustments */</p>
<p>&nbsp; &nbsp; @media (max-width: 480px) {</p>
<p>&nbsp; &nbsp; &nbsp; .gallery {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; grid-template-columns: 1fr;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; gap: 24px;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; form {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; flex-direction: column;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; gap: 10px;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; button {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; min-width: 100%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; padding: 14px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-size: 1.1rem;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; body &gt; button {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; max-width: 100%;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; padding: 14px;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; font-size: 1.2rem;</p>
<p>&nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &lt;/style&gt;</p>
<p>&nbsp; &lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p>&lt;/head&gt;</p>
<p>&lt;body&gt;</p>
<p>&nbsp; &lt;h1&gt;Saved Images for &lt;?php echo htmlspecialchars($username); ?&gt;&lt;/h1&gt;</p>
<p>&nbsp; &lt;div class="gallery"&gt;</p>
<p>&nbsp; &lt;?php foreach ($images as $img): ?&gt;</p>
<p>&nbsp; &nbsp; &lt;div&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;img src="&lt;?php echo htmlspecialchars($uploadDir . $img); ?&gt;" alt="&lt;?php echo htmlspecialchars($img); ?&gt;"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;form method="POST" aria-label="Actions for image &lt;?php echo htmlspecialchars($img); ?&gt;"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;input type="hidden" name="image" value="&lt;?php echo htmlspecialchars($img); ?&gt;"&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button type="submit" name="action" value="view"&gt;View&lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button type="submit" name="action" value="download"&gt;Download&lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &lt;button type="submit" name="action" value="delete" onclick="return confirm('Are you sure you want to delete this image?');"&gt;Delete&lt;/button&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;/form&gt;</p>
<p>&nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp; &lt;?php endforeach; ?&gt;</p>
<p>&nbsp; &lt;/div&gt;</p>
<p>&nbsp;</p>
<p>&nbsp; &lt;button onclick="window.location.href='drive.php'" aria-label="Back to Drive"&gt;Back to Drive&lt;/button&gt;</p>
<p>&lt;/body&gt;</p>
<p>&lt;/html&gt;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div>